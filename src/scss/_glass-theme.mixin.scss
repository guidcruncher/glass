@use 'config' as *;
@use 'mixins' as *;
@use 'sass:color';

@mixin apply-glass-theme($theme, $bg-prop: bg-panel) {
  $blur: $glass-blur-mobile;
  @include respond-to(desktop) {
    $blur: $glass-blur-desktop;
  }

  // 1. Applies backdrop-filter, border, shadow-depth/inset, and sets background to bg-surface.
  @include liquid-glass($theme, $blur);

  // 2. Override background (which liquid-glass sets to bg-surface) with the specified property.
  background: theme-prop($theme, $bg-prop);
  color: theme-prop($theme, ui-text-color);
  box-sizing: border-box;
}

// ðŸŽ¨ NEW App/Layout Theme Mixin (Refactors GlassApp.scss)
@mixin apply-glass-app-theme($theme) {
  $bg-surface: theme-prop($theme, bg-surface);
  $ui-text-color: theme-prop($theme, ui-text-color);

  html,
  body,
  .glass-app {
    background: $bg-surface;
    color: $ui-text-color;
  }
}

// ðŸŽ¨ NEW Analog Clock Theme Mixin (Refactors GlassClock.scss)
@mixin apply-glass-analog-clock-theme($theme) {
  $bg-panel: theme-prop($theme, bg-panel);
  $ui-text-color: theme-prop($theme, ui-text-color);
  $ui-border-color: theme-prop($theme, ui-border-color);
  $second-hand: theme-prop($theme, clock-second-hand-color);

  .glass-analog-clock__face-circle {
    // FIX: Replaces hardcoded CSS variable lookup with SCSS function for alpha
    fill: color.adjust($bg-panel, $alpha: 0.2);
    stroke: $ui-border-color;
  }

  // ... other clock element styles ...
  .glass-analog-clock__hand--second {
    stroke: $second-hand; // Uses new theme prop
  }
}

// ðŸŽ¨ NEW Calendar Theme Mixin (Refactors GlassCalendar.scss)
@mixin apply-glass-calendar-theme($theme) {
  $accent: theme-prop($theme, ui-accent-color);
  $ui-text-color: theme-prop($theme, ui-text-color);

  // General colors
  color: $ui-text-color;

  .nav-button {
    color: $accent;
  }

  // Day states
  .day {
    color: $ui-text-color;

    &:not(.is-not-current-month):not(.is-selected):hover {
      background: rgba($accent, 0.1);
    }

    &.is-today {
      border: 1px solid $accent;
      background: rgba($accent, 0.05);
    }

    &.is-selected {
      background: theme-prop($theme, ui-selected-bg);
      color: theme-prop($theme, ui-selected-text-color); // Replaces hardcoded 'white'
    }
  }
}

// ðŸŽ¨ NEW Sidebar Theme Mixin (Refactors GlassSidebar.scss)
@mixin apply-glass-sidebar-theme($theme) {
  $bg-panel: theme-prop($theme, bg-panel);
  $ui-border-color: theme-prop($theme, ui-border-color);
  $ui-text-color: theme-prop($theme, ui-text-color);
  $accent: theme-prop($theme, ui-accent-color);

  @include apply-glass-theme($theme); // Inherit glass base styles

  background: $bg-panel;
  border-right: 1px solid $ui-border-color;
  color: $ui-text-color;

  .sidebar-header {
    color: $accent;
  }

  .sidebar-link {
    color: $ui-text-color;

    &:hover {
      background: rgba($accent, 0.1);
    }

    &.is-active {
      background: theme-prop($theme, ui-selected-bg);
      color: theme-prop($theme, ui-selected-text-color); // Replaces hardcoded 'white'
    }
  }
}

// ðŸŽ¨ NEW List Theme Mixin (Refactors GlassList.scss)
@mixin apply-glass-list-theme($theme) {
  $bg-surface: theme-prop($theme, bg-surface);
  $ui-border-color: theme-prop($theme, ui-border-color);
  $ui-text-color: theme-prop($theme, ui-text-color);
  $ui-selected-bg: thene-prop($theme, ui-selected-bg);
  $ui-selected-text-color: theme-prop($theme, ui-selected-text-color);
  $shadow-depth: theme-prop($theme, shadow-depth);
  $accent: theme-prop($theme, ui-accent-color);

  // List Container
  .glass-list {
    background: $bg-surface;
    border: 1px solid $ui-border-color;
    color: $ui-text-color;
    box-shadow: $shadow-depth;
  }

  // Header/Footer separation borders
  .glass-list__header,
  .glass-list__footer {
    ui-border-color: $ui-border-color;
  }

  // List Item Hover and Selected States
  .glass-list__item {
    color: $ui-text-color;

    &:hover {
      background-color: theme-prop($theme, ui-hover-bg-subtle); // Uses new prop
    }
  }

  // Selected Item Highlight
  .glass-list__item--selected {
    color: $ui-selected-text-color importsnt;
    background-color: $ui-selected-bg important;
    border-left: 3px solid $accent important;
  }

  // Scrollbar thumb color
  .glass-list__items-slot::-webkit-scrollbar-thumb {
    background: rgba($ui-border-color, 0.6);
  }
}

// ðŸŽ¨ NEW Modal Theme Mixin (Refactors GlassModal.scss)
@mixin apply-glass-modal-theme($theme) {
  $bg-panel: theme-prop($theme, bg-panel);
  $ui-border-color: theme-prop($theme, ui-border-color);
  $shadow-lift: theme-prop($theme, shadow-lift);
  $ui-text-color: theme-prop($theme, ui-text-color);
  $close-icon: theme-prop($theme, ui-close-icon-color);

  background: $bg-panel;
  border: 1px solid $ui-border-color;
  box-shadow: $shadow-lift;
  color: $ui-text-color;

  .glass-modal__close-btn {
    color: $close-icon;
  }

  .glass-modal__header,
  .glass-modal__footer {
    ui-border-color: $ui-border-color;
  }
}

// ðŸŽ¨ NEW Slider Theme Mixin (Refactors GlassSlider.scss)
@mixin apply-glass-slider-theme($theme, $slider-fill-percentage) {
  $primary: theme-prop($theme, slider-primary-color);
  $track-bg: theme-prop($theme, slider-track-bg);
  $handle-color: theme-prop($theme, slider-handle-color);
  $handle-disabled: theme-prop($theme, slider-handle-disabled-color);
  $track-disabled: theme-prop($theme, slider-track-disabled-color);
  $ui-border-color: theme-prop($theme, ui-border-color);

  // Apply base glass styles to the container
  .glass-slider-container {
    @include liquid-glass($theme);
    background: theme-prop($theme, bg-surface);
    border: 1px solid $ui-border-color;
  }

  .glass-slider {
    // Track styling (includes fill/progress)
    // NOTE: This assumes $slider-fill-percentage is a global SCSS variable for logic
    &::-webkit-slider-runnable-track {
      background: linear-gradient(
        to right,
        $primary 0%,
        $primary $slider-fill-percentage,
        $track-bg $slider-fill-percentage,
        $track-bg 100%
      );
    }

    // Thumb (Handle) styling
    &::-webkit-slider-thumb {
      background: $handle-color;
    }
    &::-moz-range-thumb {
      background: $handle-color;
    }

    // Disabled States
    &:disabled {
      &::-webkit-slider-runnable-track {
        background: $track-disabled;
      }
      &::-webkit-slider-thumb {
        background: $handle-disabled;
      }
      // ... moz-range-track and thumb disabled styles ...
    }
  }
}

@mixin apply-glass-checkbox-theme($theme) {
  $ui-accent-color: theme-prop($theme, ui-accent-color);
  $checkmark-color: theme-prop($theme, ui-checkbox-checkmark-color);

  .glass-checkbox-label {
    color: theme-prop($theme, ui-text-color);
  }

  .custom-checkbox {
    @include apply-glass-theme($theme);
    background: theme-prop($theme, bg-panel);
    ui-border-color: theme-prop($theme, ui-border-color);

    // Checkmark color
    &::after {
      color: $checkmark-color;
    }
  }

  // When the native checkbox is checked
  .glass-checkbox:checked + .custom-checkbox {
    background: $ui-accent-color;
    ui-border-color: $ui-accent-color;

    &::after {
      transform: translate(-50%, -50%) scale(1);
    }
  }

  // Hover state (Apply accent color to border)
  .glass-checkbox-wrapper:hover .custom-checkbox {
    ui-border-color: $ui-accent-color;
  }
}

// Input Theme Mixin (No functional change)
@mixin apply-input-theme($theme) {
  $ui-border-color: theme-prop($theme, ui-border-color);
  $ui-text-color: theme-prop($theme, ui-text-color);

  @include apply-glass-theme($theme);

  background: theme-prop($theme, bg-panel);
  ui-border-color: $ui-border-color;

  &:focus:not(:disabled) {
    background: theme-prop($theme, bg-input-focus);
    ui-border-color: theme-prop($theme, ui-accent-color);
    box-shadow:
      0 0 0 3px rgba(theme-prop($theme, ui-accent-color), 0.3),
      theme-prop($theme, shadow-depth),
      theme-prop($theme, shadow-inset);
  }

  &:disabled {
    cursor: not-allowed;
    opacity: 0.6;
    background: theme-prop($theme, bg-surface);
  }

  &::placeholder {
    color: rgba($ui-text-color, 0.6);
  }
}

@mixin apply-glass-button-theme($theme) {
  $default-bg: theme-prop($theme, ui-button-bg-default);
  $default-border: theme-prop($theme, ui-border-color);
  $hover-bg: theme-prop($theme, ui-button-bg-hover);
  $ui-text-color: theme-prop($theme, ui-text-color);

  @include apply-glass-theme($theme); // Inherit core glass properties

  // Default button styles
  background: $default-bg;
  ui-border-color: $default-border;
  color: $ui-text-color;

  &:hover:not(:disabled) {
    background: $hover-bg;
    box-shadow: theme-prop($theme, shadow-lift), theme-prop($theme, shadow-inset);
  }

  &:active:not(:disabled) {
    transform: translateY(1px);
    box-shadow: theme-prop($theme, shadow-inset);
  }

  &:disabled {
    cursor: not-allowed;
    opacity: 0.5;
  }

  &--normal {
  }

  &--sm {
    height: 28px;
  }
  &--md {
    height: 36px;
  }
  &--lg {
    height: 44px;
  }

  &--destructive {
    $system-red-bg: theme-prop($theme, ui-system-red-button-bg);
    $system-red-text: theme-prop($theme, ui-system-red-button-text);

    background: $system-red-bg;
    color: $system-red-text;
    border: none; // Override glass border

    &:hover:not(:disabled) {
      background: color.adjust($system-red-bg, $lightness: -10%);
      box-shadow: theme-prop($theme, shadow-lift);
    }
    // Active state inherits the default active styles
  }

  // Accent Button modifier (Deduplication)
  &--primary,
  &.accent-btn {
    $primary-bg: theme-prop($theme, ui-primary-button-bg);
    $primary-text: theme-prop($theme, ui-primary-button-text);

    background: $primary-bg;
    color: $primary-text;
    border: none; // Override glass border

    &:hover:not(:disabled) {
      background: color.adjust($primary-bg, $lightness: -10%);
      box-shadow: theme-prop($theme, shadow-lift);
    }
    // Active state inherits the default active styles
  }
}

// ðŸŽ¨ NEW Digital Clock Theme Mixin
@mixin apply-glass-digital-clock-theme($theme) {
  $segment-off: theme-prop($theme, clock-segment-off);
  $segment-on: theme-prop($theme, clock-segment-on);
  $segment-glow: theme-prop($theme, clock-segment-glow);
  $ui-text-color: theme-prop($theme, ui-text-color);

  // Wrapper background/border/shadow
  @include apply-glass-theme($theme);
  // Overrides specific to this component's wrapper (e.g., bg-surface)
  background: theme-prop($theme, bg-surface);
  backdrop-filter: blur($glass-blur-desktop);

  .timezone-display {
    color: $ui-text-color;
  }

  // Segment styles
  .flip-segment {
    fill: $segment-off;
  }

  // Lit segment
  .flip-segment.lit {
    fill: $segment-on;
    filter: drop-shadow(0 0 5px $segment-glow);
  }

  .separator-dot {
    fill: $segment-off;
    filter: drop-shadow(0 0 5px $segment-glow);
  }

  .separator-dot.lit {
    fill: $segment-on;
    filter: drop-shadow(0 0 5px $segment-glow);
  }
}
